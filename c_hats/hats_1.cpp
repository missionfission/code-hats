#include"hats_1.hpp"
// each with 49*12 cell weights 
comp_t loc_sum[tot_cell];
int_t cntmem[tot_cell][2];
int_t cnt[tot_cell];
aer memory[tot_cell][2][800];

comp_t svm(hist_t hist[rho][rho],int_t offset){
comp_t sum=0;
comp_t weights[tot_cell*rho*rho] ={-8.149489164352416992e-01,-6.650568917393684387e-03,-2.084191888570785522e-01,5.283076167106628418e-01,-7.883610129356384277e-01,-1.085587024688720703e+00,-9.917793869972229004e-01,8.156161308288574219e-01,3.095982410013675690e-02,1.052524521946907043e-01,4.479116797447204590e-01,-1.108428537845611572e-01,2.155199646949768066e-01,1.604294404387474060e-02,1.290569007396697998e-01,5.917283296585083008e-01,1.061052083969116211e+00,-6.614407300949096680e-01,-1.026779651641845703e+00,1.556141227483749390e-01,-1.086875200271606445e-01,-1.779701709747314453e-01,-1.129617467522621155e-01,-5.288866907358169556e-02,4.234618544578552246e-01,-7.273142933845520020e-01,3.652432262897491455e-01,2.265593260526657104e-01,-1.096169576048851013e-01,-5.091853141784667969e-01,-7.316612601280212402e-01,-1.155954413115978241e-02,3.522489368915557861e-01,1.000390768051147461e+00,-4.851402938365936279e-01,9.117286801338195801e-01,-4.331445395946502686e-01,-2.597544491291046143e-01,2.214036323130130768e-02,9.017590284347534180e-01,-1.605847924947738647e-01,-1.930942386388778687e-01,-2.441553398966789246e-02,-3.713990151882171631e-01,6.873378902673721313e-02,6.615363359451293945e-01,5.168019533157348633e-01,-9.482689201831817627e-02,-2.213056832551956177e-01,-5.762344598770141602e-01,-6.746589392423629761e-02,-8.731393218040466309e-01,2.890354692935943604e-01,2.551058530807495117e-01,1.148528084158897400e-01,3.044912517070770264e-01,1.232940793037414551e+00,-6.244584918022155762e-01,-3.784830272197723389e-01,1.471719294786453247e-01,8.580396175384521484e-01,-5.976247787475585938e-01,1.859861612319946289e-02,2.834662199020385742e-01,5.750966072082519531e-01,6.844375282526016235e-02,-3.273745179176330566e-01,-4.732414782047271729e-01,-1.337136924266815186e-01,-1.288762331008911133e+00,-3.527722358703613281e-01,-2.226625010371208191e-02,1.242506384849548340e+00,7.856526374816894531e-01,-6.772606372833251953e-01,1.224358156323432922e-01,-6.653748154640197754e-01,-4.070777297019958496e-01,-3.783029690384864807e-02,-1.074710607528686523e+00,2.698263227939605713e-01,6.317449808120727539e-01,8.592205643653869629e-01,8.217483162879943848e-01,6.687419414520263672e-01,1.117422878742218018e-01,-4.185941815376281738e-01,1.604321002960205078e-01,-2.038703858852386475e-01,9.631761312484741211e-01,7.756716609001159668e-01,4.366613626480102539e-01,2.220077961683273315e-01,-2.407974898815155029e-01,3.645374178886413574e-01,-1.315517783164978027e+00,-1.780537702143192291e-02,3.171760141849517822e-01,-5.877556204795837402e-01,-2.390694320201873779e-01,-9.176309704780578613e-01,3.925457298755645752e-01,8.669715523719787598e-01,-4.142789542675018311e-01,-2.829088866710662842e-01,-1.957511454820632935e-01,6.176260113716125488e-01,1.030929312109947205e-01,8.438423871994018555e-01,2.298494800925254822e-02,1.753265708684921265e-01,-3.622195124626159668e-01,-3.462952747941017151e-02,1.284253150224685669e-01,7.298718392848968506e-02,-1.981744170188903809e-02,5.778218060731887817e-02,3.858975172042846680e-01,-1.362164765596389771e-01,-8.932781815528869629e-01,1.170745119452476501e-01,3.588506281375885010e-01,-4.720560610294342041e-01,-3.944170475006103516e-01,5.139071941375732422e-01,-2.746284902095794678e-01,-7.443189024925231934e-01,-4.894568026065826416e-01,5.790405273437500000e-01,6.476194858551025391e-01,-2.969294190406799316e-01,2.671399153769016266e-02,3.459964990615844727e-01,2.724314928054809570e-01,2.995870411396026611e-01,-1.854043751955032349e-01,1.676815152168273926e-01,-4.439494907855987549e-01,-4.563073217868804932e-01,1.748593747615814209e-01,-3.926581703126430511e-03,1.997418403625488281e-01,-2.073475867509841919e-01,1.057217270135879517e-01,-5.120516419410705566e-01,3.354787230491638184e-01,-1.160198003053665161e-01,-6.241074800491333008e-01,-1.014832377433776855e+00,-1.653897762298583984e-01,5.766075253486633301e-01,4.744460880756378174e-01,-1.327527165412902832e+00,-9.249085783958435059e-01,-3.624064624309539795e-01,-8.515791594982147217e-02,3.510430753231048584e-01,2.065673097968101501e-02,-4.458035528659820557e-01,1.252857297658920288e-01,4.109101891517639160e-01,8.778995871543884277e-01,-1.574771106243133545e-01,-2.392298132181167603e-01,-5.306704044342041016e-01,2.267891913652420044e-01,1.306228488683700562e-01,2.029212936758995056e-02,-1.451385617256164551e-01,1.339623779058456421e-01,4.518622756004333496e-01,-2.127147018909454346e-01,-1.384383141994476318e-01,5.221762061119079590e-01,-7.351760864257812500e-01,-7.217426598072052002e-02,-2.762147486209869385e-01,-2.839426994323730469e-01,1.291779398918151855e+00,1.773597151041030884e-01,-3.071978092193603516e-01,-1.075811907649040222e-01,2.041836082935333252e-01,-1.535693705081939697e-01,-2.762711346149444580e-01,7.065001875162124634e-02,-1.070400029420852661e-01,-1.811354309320449829e-01,1.861779950559139252e-02,1.336938142776489258e-01,-7.952381670475006104e-02,5.991911888122558594e-01,-9.159308671951293945e-02,4.294509291648864746e-01,-9.059172868728637695e-02,1.287599746137857437e-02,-5.251559615135192871e-01,-6.687029451131820679e-02,3.725698590278625488e-01,-2.476400434970855713e-01,-1.917836815118789673e-01,9.042453020811080933e-02,6.052702069282531738e-01,-4.845076203346252441e-01,-2.146358489990234375e-01,1.006468012928962708e-01,-1.554946899414062500e-01,9.387608766555786133e-01,6.072068214416503906e-01,3.039628565311431885e-01,2.483326494693756104e-01,-4.012165367603302002e-01,-2.241068780422210693e-01,2.671623528003692627e-01,6.857530772686004639e-02,-3.693286776542663574e-01,4.670535400509834290e-02,-1.053642153739929199e+00,3.655328452587127686e-01,9.121168255805969238e-01,2.234326153993606567e-01,-1.499445438385009766e-01,3.703915774822235107e-01,4.322738647460937500e-01,-1.816883981227874756e-01,-1.023803129792213440e-01,-4.990388154983520508e-01,-1.696254611015319824e-01,-4.794102311134338379e-01,-9.407752193510532379e-03,-6.446622014045715332e-01,-3.494560420513153076e-01,-1.349557098001241684e-02,5.800070762634277344e-01,6.070134639739990234e-01,2.019150741398334503e-02,-9.898567199707031250e-01,-5.117306113243103027e-01,1.314724534749984741e-01,3.433452174067497253e-02,7.898082733154296875e-01,4.946012049913406372e-02,-2.918200492858886719e-01,3.455049991607666016e-01,7.748159021139144897e-02,-8.776937723159790039e-01,6.709327101707458496e-01,-3.744904650375247002e-03,-3.680905997753143311e-01,-4.376421868801116943e-01,-1.653416752815246582e-01,1.094956547021865845e-01,-1.772965788841247559e-01,-1.601237058639526367e-01,6.871421635150909424e-02,1.106964424252510071e-01,5.778567790985107422e-01,2.390440553426742554e-01,1.169063616544008255e-04,-7.182918488979339600e-02,-1.017009690403938293e-01,2.445266544818878174e-01,1.759513914585113525e-01,2.117322683334350586e-01,6.786377429962158203e-01,-4.058345779776573181e-02,-1.803714185953140259e-01,-4.562613368034362793e-01,2.644147276878356934e-01,-4.629812240600585938e-01,-5.001242160797119141e-01,-3.280554711818695068e-01,-1.020565390586853027e+00,-7.643055915832519531e-01,-2.683189809322357178e-01,5.235427618026733398e-01,4.665893912315368652e-01,-7.058026194572448730e-01,1.514375358819961548e-01,-7.432968020439147949e-01,-8.110629022121429443e-02,4.305894672870635986e-01,7.864232063293457031e-01,6.180602312088012695e-01,-4.403364360332489014e-01,-3.854596614837646484e-01,7.414913177490234375e-02,4.482885599136352539e-01,5.925919413566589355e-01,1.563229322433471680e+00,2.246947139501571655e-01,-5.827919244766235352e-01,-4.283479750156402588e-01,-1.644718348979949951e-01,2.991035878658294678e-01,-4.018260240554809570e-01,5.092914104461669922e-01,1.927220672369003296e-01,-2.965163998305797577e-02,5.347122251987457275e-02,-3.948251903057098389e-01,1.616231948137283325e-01,-5.178984254598617554e-02,7.967214584350585938e-01,-3.451492488384246826e-01,-2.968654334545135498e-01,3.214636147022247314e-01,-2.496467977762222290e-01,3.795228302478790283e-01,-1.865658015012741089e-01,6.908717155456542969e-01,-5.045811533927917480e-01,-6.939051747322082520e-01,2.334646582603454590e-01,-3.724355483427643776e-03,-3.320668041706085205e-01,4.298284649848937988e-01,4.490058869123458862e-02,3.966223895549774170e-01,-1.584453135728836060e-01,1.216288097202777863e-02,1.584149599075317383e-01,-1.269256174564361572e-01,1.949884146451950073e-01,-4.384318739175796509e-02,6.412442773580551147e-02,-7.059758901596069336e-01,2.629061043262481689e-01,6.170787811279296875e-01,-7.466064095497131348e-01,-2.873140871524810791e-01,-2.739737331867218018e-01,1.574779115617275238e-02,-2.598605453968048096e-01,2.093519084155559540e-03,-1.983299385756254196e-03,-2.287361472845077515e-01,6.540114283561706543e-01,2.504234910011291504e-01,-3.601042628288269043e-01,-6.585888862609863281e-01,-4.911633431911468506e-01,-6.712118536233901978e-02,-1.824855208396911621e-01,-2.302667796611785889e-01,-1.328427623957395554e-02,-3.902876675128936768e-01,-6.186102032661437988e-01,-2.985419929027557373e-01,-5.269744992256164551e-01,-2.517212033271789551e-01,-3.172881305217742920e-01,-4.371736049652099609e-01,-1.943135410547256470e-01,-4.437170326709747314e-01,-2.371933758258819580e-01,1.989807933568954468e-02,1.221679076552391052e-01,4.051792025566101074e-01,5.968059897422790527e-01,5.541192889213562012e-01,-1.775757223367691040e-01,-1.482399851083755493e-01,-1.685352809727191925e-02,1.566013395786285400e-01,2.746843397617340088e-01,-4.093756377696990967e-01,-2.587543129920959473e-01,6.710425764322280884e-02,5.343089103698730469e-01,-6.041971445083618164e-01,3.128693997859954834e-01,1.122514128684997559e+00,6.974551677703857422e-01,9.459952265024185181e-02,-2.360551059246063232e-01,-7.278153300285339355e-01,-3.890448212623596191e-01,4.439119100570678711e-01,5.952544808387756348e-01,5.845384597778320312e-01,2.684732675552368164e-01,-2.869762182235717773e-01,-1.861955523490905762e-01,-2.740499377250671387e-01,-6.940405368804931641e-01,-3.741546571254730225e-01,1.228132843971252441e-01,-2.713418602943420410e-01,-4.268842637538909912e-01,-2.329839020967483521e-01,8.376933634281158447e-02,2.117178589105606079e-01,3.301054937765002251e-03,1.768890321254730225e-01,-7.888962030410766602e-01,-3.988409340381622314e-01,2.384468168020248413e-01,-1.499318778514862061e-01,4.572710022330284119e-02,1.241519674658775330e-01,1.301079690456390381e-01,-7.214168310165405273e-01,-2.893225289881229401e-02,1.946568042039871216e-01,-1.022646129131317139e-01,1.257779076695442200e-02,-2.568932063877582550e-02,-2.554427646100521088e-02,-2.919098734855651855e-01,-4.453067779541015625e-01,1.550437361001968384e-01,1.700387299060821533e-01,4.055084288120269775e-01,1.979354918003082275e-01,3.585687279701232910e-01,-5.603908300399780273e-01,8.956819027662277222e-02,4.546925723552703857e-01,4.621388018131256104e-02,1.909685581922531128e-01,6.764823794364929199e-01,1.111750125885009766e+00,-1.443708091974258423e-01,1.433361023664474487e-01,1.921155005693435669e-01,1.535685062408447266e-01,5.116947889328002930e-01,-5.512696132063865662e-02,3.020510673522949219e-01,3.544700741767883301e-01,4.464700818061828613e-02,4.434973597526550293e-01,-1.375278830528259277e-01,8.329136669635772705e-02,6.312104314565658569e-02,2.795576751232147217e-01,9.215175360441207886e-02,7.875858247280120850e-02,6.750763952732086182e-02,9.899552911520004272e-02,-3.720531612634658813e-02,-1.356355845928192139e-03,1.961527764797210693e-02,4.367737844586372375e-02,2.490531057119369507e-01,4.163680598139762878e-02,1.258273608982563019e-02,-5.128756538033485413e-02,-7.756742835044860840e-02,6.188634783029556274e-02,3.817684948444366455e-01,-3.427440226078033447e-01,-1.477872133255004883e-01,-4.823452979326248169e-02,-1.815426498651504517e-01,-7.071287930011749268e-02,-2.016977667808532715e-01,-9.642974287271499634e-02,2.374201547354459763e-03,-1.262705400586128235e-02,-1.093284860253334045e-01,-3.789019286632537842e-01,-1.357822418212890625e-01,1.247509419918060303e-01,3.814923465251922607e-01,-1.424160450696945190e-01,2.085148692131042480e-01,1.300111506134271622e-02,-2.809377312660217285e-01,6.466905027627944946e-02,-3.708271086215972900e-01,-2.404767572879791260e-01,-4.437031596899032593e-02,-2.507531940937042236e-01,-3.095567226409912109e-01,-5.882433429360389709e-02,1.081818714737892151e-01,-1.244160439819097519e-02,1.049260944128036499e-01,1.772853136062622070e-01,-2.246041409671306610e-02,-1.615555882453918457e-01,-4.550874605774879456e-02,1.016105487942695618e-01,2.802450954914093018e-01,-4.252317249774932861e-01,1.113458499312400818e-01,-1.582762151956558228e-01,4.832153394818305969e-02,-5.768458247184753418e-01,-3.871455192565917969e-01,-4.992105066776275635e-01,4.671329259872436523e-01,9.675240516662597656e-01,-3.707892596721649170e-01,-1.339381188154220581e-01,4.881069064140319824e-01,5.369667410850524902e-01,4.779386222362518311e-01,6.231960281729698181e-02,-1.590796746313571930e-02,-9.299033135175704956e-02,3.801398575305938721e-01,-1.258053481578826904e-01,3.602579534053802490e-01,-5.587086677551269531e-01,-8.913928270339965820e-01,-2.360939085483551025e-01,-5.880631133913993835e-02,-1.059950366616249084e-01,-1.232914090156555176e+00,-4.102681279182434082e-01,7.423629760742187500e-01,-5.775514841079711914e-01,1.521970778703689575e-01,3.723192214965820312e-01,2.570935189723968506e-01,1.399438679218292236e-01,1.637469083070755005e-01,-1.948343366384506226e-01,-1.644725911319255829e-03,2.416996210813522339e-01,-7.307063043117523193e-02,3.088853657245635986e-01,6.129770874977111816e-01,-3.541114628314971924e-01,1.188195031136274338e-02,2.720647454261779785e-01,-4.398171901702880859e-01,6.065502390265464783e-02,9.408429265022277832e-02,2.207384211942553520e-03,2.333078086376190186e-01,3.845237493515014648e-01,-5.637249946594238281e-01,2.089087814092636108e-01,2.611764669418334961e-01,-1.102195605635643005e-01,5.994843840599060059e-01,3.482457399368286133e-01,-7.478293180465698242e-01,-3.308815062046051025e-01,4.813899695873260498e-01,3.110735118389129639e-01,3.556876182556152344e-01,4.853657484054565430e-01,-4.663537442684173584e-01,-7.078996896743774414e-01,-3.216370642185211182e-01,2.639444768428802490e-01,3.285875320434570312e-01,4.495118856430053711e-01,1.192930102348327637e+00,1.478185057640075684e-01,5.254221707582473755e-02,-1.717346787452697754e+00,2.686693966388702393e-01,-2.672758698463439941e-01,1.058971524238586426e+00,-9.484170079231262207e-01,4.465224146842956543e-01,1.798180788755416870e-01,8.393614888191223145e-01,-3.531497418880462646e-01,-4.884126782417297363e-01,-8.822669982910156250e-01,4.355812370777130127e-01,-8.754374384880065918e-01,4.586279392242431641e-01,4.311119616031646729e-01,-5.394869670271873474e-02,-3.252826631069183350e-02,1.223791837692260742e-01,4.286943972110748291e-01,3.540484607219696045e-01,-1.421236097812652588e-01,3.023829460144042969e-01,1.041192412376403809e+00,1.931768059730529785e-01,5.245376825332641602e-01,-6.326288580894470215e-01,-8.812769651412963867e-01,-1.783497035503387451e-01,-5.147945284843444824e-01,-2.131483256816864014e-01,-2.311816662549972534e-01,2.650265023112297058e-02,5.437611341476440430e-01,2.732243239879608154e-01,-2.643891610205173492e-02,8.468130230903625488e-01,3.977774977684020996e-01,7.456616312265396118e-02,-6.480345129966735840e-01,7.867480516433715820e-01,-6.433767676353454590e-01,-1.806675195693969727e-01,5.490722656250000000e-01,-4.602787196636199951e-01,-8.860689997673034668e-01,-3.060671091079711914e-01,-8.321580290794372559e-02,-1.142343971878290176e-02,-1.079942956566810608e-01,-2.732968330383300781e-01,6.049881577491760254e-01,-7.430490255355834961e-01,-6.084594130516052246e-01,1.832573115825653076e-01,4.138201475143432617e-02,1.317700266838073730e+00,4.503597915172576904e-01,-2.013638913631439209e-01,-6.587386131286621094e-01,-6.490040570497512817e-02,6.143463402986526489e-02,5.552544593811035156e-01,-7.420184612274169922e-01,3.015011250972747803e-01,-3.439281880855560303e-02,5.691068768501281738e-01,2.083939462900161743e-01,4.427410066127777100e-01,1.828015893697738647e-01,-7.664330601692199707e-01,3.695609048008918762e-02,-3.327443301677703857e-01,6.333988308906555176e-01,3.545100241899490356e-02,1.526118963956832886e-01,-6.857324838638305664e-01,-9.166892766952514648e-01,-3.646280467510223389e-01,2.461651116609573364e-01,-2.920862734317779541e-01,-1.496679037809371948e-01,-2.623752951622009277e-01,-5.316972732543945312e-01,1.303819119930267334e-01,3.953315913677215576e-01,-3.148226439952850342e-01,4.908747076988220215e-01,-6.333944946527481079e-02,-1.176239475607872009e-01,-3.293384909629821777e-01,-2.354175597429275513e-01,3.437239229679107666e-01,-1.845398247241973877e-01,-2.829480469226837158e-01,-1.538521051406860352e-01,6.503192782402038574e-01,-3.471872806549072266e-01,4.931698739528656006e-01,2.025037258863449097e-02,2.406464070081710815e-01,5.957443118095397949e-01,-3.026609718799591064e-01,-2.181469649076461792e-01,-6.185569167137145996e-01,2.414010167121887207e-01,6.451248377561569214e-02,-2.374796271324157715e-01,-1.952194571495056152e-01,-2.209074199199676514e-01,9.609653800725936890e-02,7.706667780876159668e-01,5.344122648239135742e-01,-8.249146938323974609e-01,-1.086871385574340820e+00,4.473613500595092773e-01,2.240382283926010132e-01,5.440099835395812988e-01,-2.880594432353973389e-01,-3.246910497546195984e-02,2.920086383819580078e-01,-2.201140820980072021e-01,5.146794915199279785e-01,-9.752424955368041992e-01,3.640410900115966797e-01,-3.061594963073730469e-01,4.954820573329925537e-01,4.616309106349945068e-01,3.485181927680969238e-01,-8.113406598567962646e-02,-7.289798259735107422e-01,-8.535204827785491943e-02,2.637614607810974121e-01,-5.428439378738403320e-01,2.434799820184707642e-01,6.438160538673400879e-01,6.462497711181640625e-01,1.009814292192459106e-01,-8.082845807075500488e-01,2.494623661041259766e-01,-2.268444187939167023e-02,-1.459149271249771118e-01,-8.328596949577331543e-01,-2.319332659244537354e-01,-2.648679912090301514e-01,6.939914226531982422e-01,6.093808412551879883e-01,-6.115255951881408691e-01,-7.581312060356140137e-01,6.788097620010375977e-01,6.662255525588989258e-01,3.679026961326599121e-01,-8.484597206115722656e-01,4.491619169712066650e-01,-2.615018784999847412e-01,8.689758181571960449e-01,-4.018036723136901855e-01,-1.040809880942106247e-02,7.649914026260375977e-01,3.570941090583801270e-01,-4.129075407981872559e-01,-5.046535730361938477e-01,-1.127106666564941406e+00,-2.491937130689620972e-01,8.191130757331848145e-01,-1.309220194816589355e-01,-2.962530776858329773e-02,3.075976967811584473e-01,7.134289741516113281e-01,-3.517610132694244385e-01,-5.531293898820877075e-02,2.249045372009277344e-01,-3.774766921997070312e-01,2.358381301164627075e-01,-2.084066392853856087e-03,1.835818886756896973e-01,-1.374859660863876343e-01,-1.104932799935340881e-01,1.453344970941543579e-01,-1.564343571662902832e-01};
#pragma HLS RESOURCE variable=weights core=ROM_nP_BRAM latency=2
//#pragma HLS pipeline
//#pragma HLS RESOURCE variable=sum core=AddSubnS
//#pragma HLS allocation instances=fadd limit=50
for(int_t i=0;i<rho;i++){
//#pragma HLS unroll factor = N_PE
	for(int_t j=0;j<rho;j++){
		sum+=hist[i][j]*weights[offset+i*rho+j];
		}
}
return sum;
}
void computeHistogram(int_t cell_id,aer event)
{
hist_t hist[rho][rho]={0};
#pragma HLS RESOURCE variable=hist core=RAM_2P_BRAM latency=2
for(int_t i=0;i<cntmem[cell_id][event.p];i++)
	{
	 int_t x=memory[cell_id][event.p][i].y-event.y;
	 int_t y=memory[cell_id][event.p][i].x-event.x;
        if(abs(x)<=rho/2 && abs(y)<=rho/2)
      {  hist[x+rho/2][y+rho/2]+=1-(event.t-memory[cell_id][event.p][i].t)/tau;
      }
	}
 loc_sum[cell_id]+=svm(hist, cell_id*rho*rho);
}
comp_t hats(aer events[],int_t size)
{
#pragma HLS INTERFACE ap_bus port=events depth=3000
#pragma HLS INTERFACE s_axilite port=return bundle=CONTROL_BUS
comp_t sum=0;
int_t cell_id;
#pragma HLS RESOURCE variable=cnt core=RAM_2P_BRAM
#pragma HLS RESOURCE variable=memory core=RAM_2P_BRAM
#pragma HLS RESOURCE variable=cntmem core=RAM_2P_BRAM
#pragma HLS reset variable=cnt
#pragma HLS reset variable=cntmem
#pragma HLS reset variable=loc_sum
memset(cnt, 0, sizeof(cnt[0])*tot_cell);
memset(cntmem, 0, sizeof(cntmem[0][0])*tot_cell*2);
for (int i=0;i<tot_cell;i++)
	loc_sum[i]=0;
for(int_t j=0;j<size;j++)
	{
	cell_id= (events[j].y)/10;
	computeHistogram(cell_id,events[j]);
	memory[cell_id][events[j].p][cntmem[cell_id][events[j].p]]=events[j];
	cntmem[cell_id][events[j].p]++;
	cnt[cell_id]++;
	}

for(int_t k=0;k<tot_cell;k++)
{if(cnt[k]>0)
sum+=loc_sum[k]/cnt[k];
}
return sum;
}

